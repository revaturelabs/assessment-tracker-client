let onHome=offPage,onBatch=onPage,onAssess=offPage,onNotes=offPage,batch={id:1,name:"",trainingTrack:"",startDate:"",currentWeek:71,totalWeeks:0},assesssments={};function pageDataToLoad(){$("#mainbody").html(tempMainContentHolder),getIDFromUrl()?(batch.id=getIDFromUrl(),batchData(batch.id,batch)):document.getElementById("mainbody").innerHTML=`
    <div id="batchLoader" class="d-flex justify-content-center"></div>
    <div id="panels">
        <div class="d-flex mb-5">
            <div id="empty" class="col col-12 p-0">
                <div class="card bg-darker">
                    <div class="card-body rounded">
                    <p>No batches have been selected! Please type in the search bar to find a batch or go back <a href="home">home</a> to select a batch!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>`}const panels=document.getElementById("panels");function addWeek(a){let b="";for(i=1;i<=a;i++)b+=newWeek(i);for(document.getElementById("mainbody").innerHTML=`
    <div id="batchLoader" class="d-flex justify-content-center"></div>
    <div id="panels" class="card bg-darker p-3">
        <h3 class="card-title text-center"><i class="fa fa-users" aria-hidden="true"></i>&nbsp;<strong>${batch.trainingTrack} - ${batch.name}</strong></h3>
        <p class="text-muted text-center">All the weeks for this batch. Total is ${batch.totalWeeks} weeks</p>
        ${b}
    </div>`,i=1;i<=a;i++)getAssessments(i)}function displayAssessments(a){let b="",c=assesssments;return Array.prototype.forEach.call(a,a=>{assesssments["assessment"+a.assessmentId]=a,c["assessment"+a.assessmentId]=assesssments["assessment"+a.assessmentId],batch["week"+a.weekId]=c,b+=`<li class="m-2" id="assessment${a.assessmentId}"><a onclick="batch.currentWeek = ${a.weekId};batch.currentID = ${a.assessmentId};document.getElementById('assessWeightTitle').innerHTML = '${a.assessmentTitle} Weight';document.getElementById('weightControl').value = batch.week${a.weekId}.assessment${a.assessmentId}.assessmentWeight;document.getElementById('weightValue').innerHTML = batch.week${a.weekId}.assessment${a.assessmentId}.assessmentWeight;" id="assessment_${a.assessmentId}" data-toggle="modal" href="#adjustWeightModal">${a.assessmentTitle}</a></li>`}),console.log(batch),b}function newWeek(a){return`
    <div class="d-flex mb-5">
        <div id="week_${a}" class="col col-12 p-0">
            <div class="card bg-darker">
                <div class="card-body rounded">
                    <div id="batchLoader${a}" class="d-flex justify-content-center"></div>
                    <div class="d-flex flex-wrap justify-content-around">
                        <div class="d-flex-inline-block flex-fill">
                            <h3 class="card-title"><strong>Week ${a}</strong></h3>
                            <ul class=" card-text overflow-auto assess-panel" id="week${a}Assessments">
                                -No Assessments Yet-
                            </ul>
                            <button onclick="document.getElementById('assessment-week').innerHTML = ${a}" id="addAssessmentBtn" class="btn btn-secondary border-0 d-block" data-toggle="modal" data-target="#createAssessmentModal"><i class="fa fa-plus" aria-hidden="true"></i>&nbsp;Assessment</button>
                        </div>
                        <div class="d-flex-inline-block flex-fill bg-darkest rounded p-3">
                            <h3>Associates</h3>
                            <ul id="${a}" class="d-inline-block card-text overflow-auto assess-panel allAssociates col col-12">
                                -No Associates-
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>`}function getAssessments(a){let b=`assessments/batch/${batch.id}/${a}`,c=java_base_url+b;ajaxCaller("GET",c,getAssessments_complete,`week${a}Assessments`,"batchLoader"+a,"")}function getAssessments_complete(a,b,c){if(200==a){let a=JSON.parse(b);console.log(a),0>=Object.keys(a).length?document.getElementById(c).innerHTML="-No Assessments Yet-":(console.log(a),document.getElementById(c).innerHTML=displayAssessments(a),console.log("batch"),console.log(batch))}else 201==a?document.getElementById(c).innerHTML=JSON.parse(b):400==a?document.getElementById(c).innerHTML=b:0==a&&(document.getElementById(c).innerHTML="-No Assessments Yet-")}function batchData(a,b){let c=base_url+("batch/"+a);ajaxCaller("GET",c,batchData_complete,b,"batchLoader","")}function batchData_complete(a,b,c){if(200==a){let a=JSON.parse(b);c=a,batch=c,addWeek(batch.totalWeeks),getAssociates()}else 201==a?document.getElementById(c).innerHTML=JSON.parse(b):400==a&&(document.getElementById(c).innerHTML=b)}function createAssessment(){let a=java_base_url+"assessments",b=document.getElementById("assessment-week").innerHTML,c={assessmentTitle:document.getElementById("assessment-title").value,typeId:document.getElementById("assessment-type").value,batchId:batch.id,weekId:document.getElementById("assessment-week").innerHTML,assessmentWeight:100};console.log(b),ajaxCaller("POST",a,createAssessment_complete,`week${b}Assessments`,"batchLoader"+b,c)}function createAssessment_complete(a,b,c){if(200==a){let a=JSON.parse(b);console.log([a]),"-No Assessments Yet-"==document.getElementById(c).innerHTML?document.getElementById(c).innerHTML=displayAssessments([a]):document.getElementById(c).innerHTML+=displayAssessments([a])}else 201==a?document.getElementById(c).innerHTML=JSON.parse(b):400==a&&(document.getElementById(c).innerHTML=b)}function updateWeight(a,b,c){let d=java_base_url+`assessments/weight/${b}/${c}`;batch[`week${a}`][`assessment${b}`].assessmentWeight=c;let e=batch[`week${a}`][`assessment${b}`].assessmentWeight;ajaxCaller("PUT",d,updateWeight_complete,e,"WeightLoad","")}function updateWeight_complete(a,b,c){if(200==a){JSON.parse(b);console.log("batch"),console.log(batch)}else 201==a?document.getElementById(c).innerHTML=JSON.parse(b):400==a?document.getElementById(c).innerHTML=b:0==a&&(document.getElementById(c).innerHTML="-Could not find a weight-")}function getAssociates(){let a=`associates/${batch.id}`,b=base_url+a;ajaxCaller("GET",b,getAssociates_complete,"allAssociates","batchLoader","")}function getAssociates_complete(a,b,c){if(200==a){let a=JSON.parse(b);console.log(a),loadinfoByClass(c,printAssociates(a))}else 201==a?document.getElementById(c).innerHTML=JSON.parse(b):404==a?loadinfoByClass(c,"-No Associates-"):0==a&&(document.getElementById(c).innerHTML="-No Associates-")}function UpdateScores(a,b,c,d){let e=java_base_url+`grades/`,f={assessmentId:b,associateId:batch.currentAssoc,score:a};ajaxCaller("PUT",e,UpdateScores_complete,c,d,f)}function UpdateScores_complete(a,b,c){200==a?(console.log(JSON.parse(b)),b&&(document.getElementById(c).innerHTML=`<p class="text-success">Your grade was saved!</p>`)):201==a?document.getElementById(c).innerHTML=`<p class="text-success">${b}</p>`:404==a?document.getElementById(c).innerHTML=`<p class="text-danger">${b}</p>`:0==a&&(document.getElementById(c).innerHTML=`<p class="text-danger">${b}</p>`)}function getScore(a,b,c,d){let e=java_base_url+`grade/${b}/${a}`;ajaxCaller("GET",e,getScore_complete,c,d,"")}function getScore_complete(a,b,c,d){200==a?null!=b&&(document.getElementById(c).value=JSON.parse(b).score):201==a?document.getElementById(d).innerHTML=`<p class="text-success">${b}</p>`:404==a?document.getElementById(d).innerHTML=`<p class="text-danger">${b}</p>`:0==a&&(document.getElementById(d).innerHTML=`<p class="text-danger">${b}</p>`),console.log(b)}function printAssociates(a){let b="";return $.each(a,c=>{b+=`<li class="m-2" id="associate${a[c].id}"><a onclick="batch.currentAssoc = ${a[c].id};batch.currentWeek = this.parentNode.parentNode.getAttribute('id');printWeekAssess(this.parentNode.parentNode.getAttribute('id'));executePreLoadScores();document.getElementById('assessScoreTitle').innerHTML = 'Week '+this.parentNode.parentNode.getAttribute('id');document.getElementById('studentName').innerHTML = '${a[c].firstName}';" data-toggle="modal" href="#giveScores">${a[c].firstName}</a></li>`}),b}function printWeekAssess(a){console.log(batch["week"+a]),batch.loadScores={};let b="";document.getElementById("scoreForms").innerHTML=b,$.each(batch["week"+a],(c,d)=>{a==d.weekId&&(batch.loadScores[`score${d.assessmentId}`]={},batch.loadScores[`score${d.assessmentId}`].assessmentId=d.assessmentId,batch.loadScores[`score${d.assessmentId}`].associateId=batch.currentAssoc,batch.loadScores[`score${d.assessmentId}`].response_loc=`score${d.assessmentId}`,batch.loadScores[`score${d.assessmentId}`].load_loc=`loadScoreResult${d.assessmentId}`,b+=`
            <form id="GiveScoreForm${d.assessmentId}" class="needs-validation" novalidate autocomplete="off">
                <div id="scoreFormElem${d.assessmentId}">
                    <div class="form-group">
                        <label for="score${d.assessmentId}">${d.assessmentTitle}</label>
                        <input placeholder="Please type a score out of 100%" type="number" step="0.01" min="0.01" max="100" class="form-control" id="score${d.assessmentId}" name="score${d.assessmentId}" required>
                        <div class="invalid-feedback">
                            Please type a valid Score percentage out of 100%.
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <span id="loadScoreResult${d.assessmentId}"></span><span id="ScoreLoad${d.assessmentId}"></span>
                    <button onclick="let form = document.getElementById('GiveScoreForm${d.assessmentId}');
                    if (form.checkValidity() === true) {
                        batch.currentScores = new Object();
                        UpdateScores(document.getElementById('score${d.assessmentId}').value,${d.assessmentId},'loadScoreResult${d.assessmentId}','ScoreLoad${d.assessmentId}');
                    }" type="submit" class="btn btn-info">Save &nbsp;<i class="fa fa-floppy-o" aria-hidden="true"></i></button>
                    <button type="button" class="btn btn-warning" data-dismiss="modal">Close <i class="fa fa-times-circle-o" aria-hidden="true"></i></button>
                </div>
            </form>`)}),b?(document.getElementById("scoreForms").innerHTML=b,newGenForms()):document.getElementById("scoreForms").innerHTML="<p>No Assessments have been assigned to this week!</p>"}function executePreLoadScores(){$.each(batch.loadScores,(a,b)=>{getScore(b.assessmentId,b.associateId,b.response_loc,b.load_loc)})}